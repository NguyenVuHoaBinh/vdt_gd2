<configuration>
<!-- WebSocket Appender Configuration -->
<appender name="WEBSOCKET" class="Viettel.backend.logs_tracing.SQLLogWebAppender" />

<!-- Define Logstash appender -->
<springProperty name="LOGBACK_URL" source="logback.destination.url"/>
<springProperty name="LOGBACK_PORT" source="logback.destination.port"/>
<appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
    <destination>${LOGBACK_URL:- }:${LOGBACK_PORT:- }</destination> <!-- Ensure Logstash is running on this host and port -->
    <encoder class="net.logstash.logback.encoder.LogstashEncoder">
        <!-- Optional: Define custom fields or additional configuration if needed -->
        <customFields>{"appName":"CCAI"}</customFields>
    </encoder>
</appender>

<!-- Console Appender -->
<appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="net.logstash.logback.encoder.LogstashEncoder" />
</appender>

<!-- Rolling File Appender -->
<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_PATH}/application.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
        <fileNamePattern>${LOG_PATH}/application.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
        <maxFileSize>10MB</maxFileSize>
        <maxHistory>30</maxHistory>
        <totalSizeCap>100MB</totalSizeCap>
    </rollingPolicy>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder" />
</appender>

<!-- Logger Configuration -->
<logger name="Viettel.backend.controller.SQLChatController" level="DEBUG" additivity="false">
    <appender-ref ref="WEBSOCKET" />
    <appender-ref ref="CONSOLE" />
    <appender-ref ref="FILE" />
    <appender-ref ref="LOGSTASH" />
</logger>

<!-- Default root logger configuration -->
<root level="INFO">
    <appender-ref ref="CONSOLE" />
    <appender-ref ref="FILE" />
    <appender-ref ref="LOGSTASH" />
</root>

</configuration>
